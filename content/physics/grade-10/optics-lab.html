<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Optics Laboratory - Grade 10 Physics - Viveka</title>
    
    <!-- Viveka metadata -->
    <meta name="viveka:subject" content="Physics">
    <meta name="viveka:grade" content="10">
    <meta name="viveka:topic" content="Optics Laboratory">
            
    <!-- Viveka styles -->
    <link rel="stylesheet" href="../../../shared/viveka-core.css">
    
    <style>
        :root {
            --sim-bg: #0f1116;
            --sim-panel: #181b22;
            --sim-accent: #6ea8fe;
        }
        
        .sim-header {
            display: flex;
            gap: var(--space-md);
            align-items: center;
            padding: var(--space-md);
            background: var(--panel);
            border-bottom: 1px solid rgba(255,255,255,0.08);
            position: sticky;
            top: 0;
            z-index: 10;
            flex-wrap: wrap;
        }
        
        .sim-header h1 {
            font-size: 1rem;
            margin: 0;
            font-weight: 600;
        }
        
        .sim-container {
            display: grid;
            grid-template-columns: 1fr 320px;
            gap: var(--space-md);
            padding: var(--space-md);
        }
        
        .canvas-wrap {
            background: #0d1016;
            border: 1px solid rgba(255,255,255,0.08);
            border-radius: var(--radius-lg);
            overflow: hidden;
            position: relative;
        }
        
        .control-panel {
            background: var(--panel);
            border: 1px solid rgba(255,255,255,0.08);
            border-radius: var(--radius-lg);
            padding: var(--space-lg);
            height: fit-content;
            position: sticky;
            top: 80px;
        }
        
        .control-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: var(--space-sm);
            margin: var(--space-lg) 0;
        }
        
        .control-row label {
            color: var(--muted);
            font-size: 0.8rem;
        }
        
        .control-row .val {
            min-width: 64px;
            text-align: right;
            color: var(--text);
            font-variant-numeric: tabular-nums;
            font-size: 0.8rem;
        }
        
        .legend {
            position: absolute;
            left: var(--space-md);
            top: var(--space-md);
            background: rgba(0,0,0,0.35);
            backdrop-filter: blur(6px);
            padding: var(--space-lg);
            border: 1px solid rgba(255,255,255,0.08);
            border-radius: var(--radius-md);
            max-width: 52%;
            box-shadow: 0 6px 20px rgba(0,0,0,0.25);
        }
        
        .legend h2 {
            margin: 0 0 var(--space-sm) 0;
            font-size: 1rem;
        }
        
        .legend p {
            margin: var(--space-xs) 0;
            font-size: 0.8rem;
            color: var(--muted);
            line-height: 1.4;
        }
        
        .legend code {
            background: var(--chip);
            color: var(--hit);
            padding: 2px var(--space-sm);
            border-radius: var(--radius-sm);
            font-size: 0.75rem;
        }
        
        .hint {
            color: var(--muted);
            font-size: 0.75rem;
            margin-top: var(--space-sm);
            line-height: 1.4;
        }
        
        select, input[type="range"], input[type="number"] {
            background: var(--chip);
            color: var(--text);
            border: 1px solid var(--chip-b);
            border-radius: var(--radius-sm);
            padding: var(--space-sm);
            outline: none;
        }
        
        select:focus, input[type="range"]:focus, input[type="number"]:focus {
            border-color: var(--accent);
        }
        
        .toggle {
            background: var(--chip);
            border: 1px solid var(--chip-b);
            color: var(--text);
            padding: var(--space-sm) var(--space-md);
            border-radius: var(--radius-sm);
            cursor: pointer;
            user-select: none;
            transition: all var(--transition-normal);
        }
        
        .toggle:hover {
            border-color: var(--accent);
        }
        
        .toggle.active {
            border-color: var(--hit);
            box-shadow: inset 0 0 0 1px var(--hit);
        }
        
        .toggles {
            display: flex;
            gap: var(--space-sm);
            flex-wrap: wrap;
        }
        
        .btn {
            background: var(--chip);
            border: 1px solid var(--chip-b);
            color: var(--text);
            padding: var(--space-sm) var(--space-md);
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: border-color var(--transition-normal);
        }
        
        .btn:hover {
            border-color: var(--accent);
        }
        
        .spacer { flex: 1; }
        
        .footer {
            color: var(--muted);
            padding: var(--space-md);
            font-size: 0.75rem;
            line-height: 1.4;
        }
        
        input[type="file"] { display: none; }
        
        @media (max-width: 768px) {
            .sim-container {
                grid-template-columns: 1fr;
            }
            .control-panel {
                position: static;
            }
        }
    </style>
</head>
<body>
    <!-- Viveka Breadcrumb Navigation -->
    <div class="viveka-breadcrumb">
        <a href="../../../index.html">Home</a> > 
        <a href="../index.html">Physics</a> > 
        <strong>Optics Laboratory</strong>
    </div>

    <div class="sim-header">
        <h1>Optics Laboratory - Interactive Physics Simulation</h1>
        
        <select id="module">
            <option value="reflection">Reflection (Mirror)</option>
            <option value="refraction">Refraction & Snell's Law</option>
            <option value="lens">Thin Lens Imaging</option>
            <option value="doubleSlit">Double-Slit Interference</option>
            <option value="singleSlit">Single-Slit Diffraction</option>
            <option value="polarization">Polarization (Malus)</option>
            <option value="rgb">RGB Color Mixing</option>
        </select>

        <div class="toggles">
            <div class="toggle" id="toggleGrid">Grid</div>
            <div class="toggle active" id="toggleAA">Anti-alias</div>
            <div class="toggle active" id="toggleGlow">Glow</div>
            <div class="toggle active" id="toggleGuides">Guides</div>
            <div class="toggle" id="togglePerf">Performance</div>
        </div>

        <div class="spacer"></div>

        <button class="btn" id="btnExport">Export PNG</button>
        <button class="btn" id="btnSave">Save JSON</button>
        <button class="btn" id="btnLoad">Load JSON</button>
        <div class="toggle" id="toggleAutosave">Auto-save</div>
        <input type="file" id="fileInput" accept="application/json" />
    </div>

    <div class="sim-container">
        <div class="canvas-wrap">
            <div class="legend" id="legend"></div>
            <main id="p5-holder"></main>
        </div>
        <aside class="control-panel" id="controls"></aside>
    </div>

    <div class="footer">
        <strong>Instructions:</strong> Drag interactive elements in the scene (ray source, object, slit bar). 
        Hold Shift for finer slider adjustments. Use Save/Load to preserve your experimental setups. 
        Export PNG to capture your results for reports.
    </div>

    <script src="https://cdn.jsdelivr.net/npm/p5@1.9.2/lib/p5.min.js"></script>
    
    <!-- Simulation Modules -->
    <script src="simulations/optics-lab/modules/reflection.js"></script>
    
    <!-- Main Controller -->
    <script src="simulations/optics-lab/optics-lab.js"></script>
    
    <!-- p5.js Integration -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            window.opticsLab = new OpticsLab();
            
            const sketch = (p) => {
                window.p5Instance = p;
                
                p.setup = () => {
                    const holder = p.select('#p5-holder');
                    p.createCanvas(window.opticsLab.W, window.opticsLab.H).parent(holder);
                    p.pixelDensity(1);
                    
                    window.opticsLab.buildControls();
                    window.opticsLab.updateLegend();
                };

                p.draw = () => {
                    window.opticsLab.render(p);
                };

                p.mousePressed = () => {
                    window.opticsLab.handleMousePressed(p, p.mouseX, p.mouseY);
                };

                p.mouseDragged = () => {
                    window.opticsLab.handleMouseDragged(p.mouseX, p.mouseY);
                };

                p.mouseReleased = () => {
                    window.opticsLab.handleMouseReleased();
                };
            };

            new p5(sketch);
        });
    </script>
</body>
</html>